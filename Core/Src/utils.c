/* ==================================================================== */
/* ============================= INCLUDES ============================= */
/* ==================================================================== */

#include <stdbool.h>
#include "utils.h"
#include "main.h"

/* ==================================================================== */
/* ============================= DEFINES ============================== */
/* ==================================================================== */

#define US_DELAY_TIMEOUT    10

/* ==================================================================== */
/* ======================= EXTERNAL VARIABLES ========================= */
/* ==================================================================== */

extern bool usDelayActive;
extern TIM_HandleTypeDef htim7;

/* ==================================================================== */
/* =================== GLOBAL FUNCTION DEFINITIONS ==================== */
/* ==================================================================== */

void delayMicroseconds(uint32_t us)
{
    if(!usDelayActive)
    {
        usDelayActive = true;
        __HAL_TIM_SET_AUTORELOAD(&htim7, us - 1);
        HAL_TIM_Base_Start_IT(&htim7);
        xTaskNotifyWait(0, 0, NULL, US_DELAY_TIMEOUT);
    }
}
